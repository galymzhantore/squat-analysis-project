# Squat Analysis

Анализ видео приседаний с подсчётом повторений.

## Идея решения

1. **Детекция позы** — MediaPipe Pose извлекает координаты ключевых точек тела (бедро, колено, лодыжка).

2. **Вычисление угла** — угол в колене вычисляется через `atan2`, что даёт стабильный результат вблизи 0° и 180° (в отличие от скалярного произведения).

3. **Сглаживание сигнала** — применяется EMA для устранения дрожания:
   ```
   angle = alpha * current + (1 - alpha) * previous
   ```

4. **Подсчёт повторений** — детекция локальных минимумов. Повторение засчитывается когда угол опускается ниже порога и затем поднимается на заданную величину.

## Установка

```bash
pip install -r requirements.txt
```

## Использование

```bash
python main.py --input video.mp4 --output result.mp4 --json results.json
```

### Параметры

- `--input`, `-i` — входное видео (обязательно)
- `--output`, `-o` — выходное видео с аннотациями
- `--json`, `-j` — файл с результатами по кадрам
- `--side` — какую ногу анализировать: `left` или `right` (по умолчанию `left`)
- `--bottom` — порог угла для нижней точки (по умолчанию 90)
- `--rise` — на сколько градусов должен подняться угол для засчёта повторения (по умолчанию 20)

## Docker

```bash
docker build -t squat-analysis .
docker run -v $(pwd):/app squat-analysis --input /app/video.mp4 --output /app/output.mp4
```

## Тесты

```bash
pytest tests/ -v
```
